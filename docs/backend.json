{
  "entities": {
    "SensorData": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SensorData",
      "type": "object",
      "description": "Represents a single sensor data point.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the sensor data point."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the sensor data was recorded.",
          "format": "date-time"
        },
        "value": {
          "type": "number",
          "description": "The raw sensor value."
        },
        "convertedValue": {
          "type": "number",
          "description": "The sensor value after conversion (e.g., voltage, custom unit)."
        },
        "unit": {
          "type": "string",
          "description": "The unit of measurement for the sensor data (e.g., RAW, V, bar)."
        },
        "sensorConfigId": {
          "type": "string",
          "description": "Reference to SensorConfiguration. (Relationship: SensorConfiguration 1:N SensorData)"
        },
        "testSessionId": {
            "type": "string",
            "description": "Reference to the test session this data point belongs to."
        }
      },
      "required": [
        "id",
        "timestamp",
        "value",
        "convertedValue",
        "unit",
        "sensorConfigId"
      ]
    },
    "SensorConfiguration": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SensorConfiguration",
      "type": "object",
      "description": "Represents the configuration settings for a sensor.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the sensor configuration."
        },
        "mode": {
          "type": "string",
          "description": "The display mode of the sensor (RAW, VOLTAGE, CUSTOM)."
        },
        "arduinoVoltage": {
          "type": "number",
          "description": "The reference voltage of the Arduino (used for voltage conversion)."
        },
        "customUnit": {
          "type": "string",
          "description": "The custom unit of measurement for the sensor (used in CUSTOM mode)."
        },
        "minValue": {
          "type": "number",
          "description": "The minimum value for the sensor (used in CUSTOM mode)."
        },
        "maxValue": {
          "type": "number",
          "description": "The maximum value for the sensor (used in CUSTOM mode)."
        }
      },
      "required": [
        "id",
        "mode",
        "arduinoVoltage",
        "customUnit",
        "minValue",
        "maxValue"
      ]
    },
    "AnalysisResult": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AnalysisResult",
      "type": "object",
      "description": "Represents the result of a leak analysis.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the analysis result."
        },
        "analysisModel": {
          "type": "string",
          "description": "The analysis model used (linear_leak, nonlinear_leak)."
        },
        "rSquared": {
          "type": "number",
          "description": "The R-squared value of the analysis."
        },
        "analyzedRangeStart": {
          "type": "string",
          "description": "Timestamp of the start of the analyzed data range.",
          "format": "date-time"
        },
        "analyzedRangeEnd": {
          "type": "string",
          "description": "Timestamp of the end of the analyzed data range.",
          "format": "date-time"
        },
        "isLeak": {
          "type": "boolean",
          "description": "Indicates whether a leak was detected."
        }
      },
      "required": [
        "id",
        "analysisModel",
        "rSquared",
        "analyzedRangeStart",
        "analyzedRangeEnd",
        "isLeak"
      ]
    },
    "TestSession": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "TestSession",
        "type": "object",
        "description": "Represents a single test session for a specific product.",
        "properties": {
            "id": { "type": "string", "description": "Unique identifier for the test session." },
            "productIdentifier": { "type": "string", "description": "Full product identifier, e.g., [c.su300.8b.b]-187." },
            "serialNumber": { "type": "string", "description": "The serial number of the product." },
            "model": { "type": "string", "description": "The model of the product." },
            "description": { "type": "string", "description": "A description of the test session." },
            "startTime": { "type": "string", "format": "date-time", "description": "Timestamp when the test started." },
            "endTime": { "type": "string", "format": "date-time", "description": "Timestamp when the test ended." },
            "status": { "type": "string", "enum": ["RUNNING", "COMPLETED", "SCRAPPED"], "description": "The status of the test session." },
            "sensorConfigurationId": { "type": "string", "description": "The sensor configuration used for this test." }
        },
        "required": ["id", "productIdentifier", "startTime", "status", "sensorConfigurationId"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/sensor_configurations/{sensorConfigurationId}/sensor_data/{sensorDataId}",
        "definition": {
          "entityName": "SensorData",
          "schema": {
            "$ref": "#/backend/entities/SensorData"
          },
          "description": "Stores sensor data points associated with a specific sensor configuration owned by a user.  Data is isolated to authenticated user via path based ownership",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "sensorConfigurationId",
              "description": "The unique identifier of the sensor configuration."
            },
            {
              "name": "sensorDataId",
              "description": "The unique identifier of the sensor data point."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/sensor_configurations/{sensorConfigurationId}",
        "definition": {
          "entityName": "SensorConfiguration",
          "schema": {
            "$ref": "#/backend/entities/SensorConfiguration"
          },
          "description": "Stores sensor configurations owned by a specific user. Data is isolated to authenticated user via path based ownership",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "sensorConfigurationId",
              "description": "The unique identifier of the sensor configuration."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/analysis_results/{analysisResultId}",
        "definition": {
          "entityName": "AnalysisResult",
          "schema": {
            "$ref": "#/backend/entities/AnalysisResult"
          },
          "description": "Stores leak analysis results generated from a user's sensor data. Data is isolated to authenticated user via path based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "analysisResultId",
              "description": "The unique identifier of the analysis result."
            }
          ]
        }
      },
       {
        "path": "/users/{userId}/test_sessions/{testSessionId}",
        "definition": {
          "entityName": "TestSession",
          "schema": { "$ref": "#/backend/entities/TestSession" },
          "description": "Stores test sessions for a user, linking a product to a set of sensor data.",
           "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "testSessionId",
              "description": "The unique identifier of the test session."
            }
          ]
        }
      }
    ],
    "reasoning": "This Firestore data structure is designed to support the BioThrust Dashboard application, focusing on real-time sensor data collection, storage, and analysis. The design prioritizes Authorization Independence, clarity, and scalability.\n\n**Authorization Independence and QAPs:**\n\n*   The structure utilizes Path-Based Ownership. All sensor data is stored under a top-level `users/{userId}` collection, ensuring that only the authenticated user can read and write their own data. This avoids the need for complex security rules that rely on `get()` calls, thus satisfying Authorization Independence.\n*   The `sensor_configurations` are also stored under a user id collection, which allows only the current authenticated user to access and read the data and associated data points.\n*   This structure supports secure `list` operations (QAPs) because listing the sensor data under `/users/{userId}/sensor_configurations/{sensorConfigurationId}/sensor_data` only returns data accessible to the authenticated user.\n*   The `test_sessions` collection is also stored under a user ID, linking specific product tests to the user who ran them."
  }
}